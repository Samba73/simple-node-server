---
- hosts: staging
  become: true
  vars:
    docker_ecs_login_password: "{{ lookup('env','ECS_LOGIN_PASSWORD') }}"
  gather_facts: no
  environment:
    PYTHONPATH: "{{ lookup('env','PYTHONPATH') }}:/usr/local/lib/python2.7/dist-packages:/usr/local/lib/python2.7/site-packages"
  tasks:
       - name: install pip
         apt:
            name: python3-pip
            state: present
       - name: install docker
         apt:
            name: docker
            state: present
       - name: start docker
         service:
            name: docker
            state: started
            enabled: yes
       - name: install docker-py python module
         pip:
            name: docker-py
            state: latest
       - name: deploy the container
         docker_container:
               name: node-server
               image: "samba73/node-server-new"
               state: started
                          
